server:
  port: 8086

spring:
  application:
    name: gateway-service
  profiles:
    active: dev
  cloud:
    compatibility-verifier:
      enabled: false
    gateway:
      globalcors:
        cors-configurations:
          "[/**]":
            allowed-origin-patterns: "*"
            allowed-methods: "*"
            allowed-headers: "*"
            allow-credentials: true
            max-age: 3600
      routes:
        # User Service API
        - id: user-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/users/**

        # Product Service API
        - id: product-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/products/**, /api/categories/**, /api/reviews/**, /api/tags/**, /api/auth-test/**, /api/health/**, /api/test/**

        # Cart service API
        - id: cart-service
          uri: http://localhost:8084
          predicates:
            - Path=/api/cart/**, /api/actuator

        # Order service API
        - id: order-service
          uri: http://localhost:8085
          predicates:
            - Path=/api/orders/**, /api/actuator

        # Gateway Swagger UI (main entry point)
        - id: gateway-swagger-ui
          uri: http://localhost:8086
          predicates:
            - Path=/swagger-ui/**, /swagger-ui.html
          filters:
            - RewritePath=/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        # Swagger UI Proxies
        - id: swagger-user-service
          uri: http://localhost:8081
          predicates:
            - Path=/swagger-user/**
          filters:
            - RewritePath=/swagger-user/(?<segment>.*), /swagger-ui/${segment}

        - id: swagger-user-api-docs
          uri: http://localhost:8081
          predicates:
            - Path=/swagger-user/v3/api-docs
          filters:
            - RewritePath=/swagger-user/v3/api-docs, /v3/api-docs

        - id: swagger-notification-service
          uri: http://localhost:8082
          predicates:
            - Path=/swagger/notification/**
          filters:
            - RewritePath=/swagger/notification/(?<segment>.*), /${segment}

        - id: swagger-notification-api-docs
          uri: http://localhost:8082
          predicates:
            - Path=/swagger/notification/v3/api-docs
          filters:
            - RewritePath=/swagger/notification/v3/api-docs, /v3/api-docs

        - id: swagger-product-service
          uri: http://localhost:8083
          predicates:
            - Path=/swagger/product/**
          filters:
            - RewritePath=/swagger/product/(?<segment>.*), /${segment}

        - id: swagger-product-api-docs
          uri: http://localhost:8083
          predicates:
            - Path=/swagger/product/v3/api-docs
          filters:
            - RewritePath=/swagger/product/v3/api-docs, /v3/api-docs

        - id: swagger-cart-service
          uri: http://localhost:8084
          predicates:
            - Path=/swagger/cart/**
          filters:
            - RewritePath=/swagger/cart/(?<segment>.*), /${segment}

        - id: swagger-cart-api-docs
          uri: http://localhost:8084
          predicates:
            - Path=/swagger/cart/v3/api-docs
          filters:
            - RewritePath=/swagger/cart/v3/api-docs, /v3/api-docs

        - id: swagger-order-service
          uri: http://localhost:8085
          predicates:
            - Path=/swagger/order/**
          filters:
            - RewritePath=/swagger/order/(?<segment>.*), /${segment}

        - id: swagger-order-api-docs
          uri: http://localhost:8085
          predicates:
            - Path=/swagger/order/v3/api-docs
          filters:
            - RewritePath=/swagger/order/v3/api-docs, /v3/api-docs

# Management Endpoints
management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: always

# Swagger/OpenAPI Configuration
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    urls:
      - url: /swagger-user/v3/api-docs
        name: User Service
      - url: /swagger/notification/v3/api-docs
        name: Notification Service
      - url: /swagger/product/v3/api-docs
        name: Product Service
      - url: /swagger/cart/v3/api-docs
        name: Cart Service
      - url: /swagger/order/v3/api-docs
        name: Order Service

info:
  app:
    name: Gateway Service
    version: 1.0.0

# JWT settings (same across environments)
jwt:
  secret: ${JWT_SECRET:uP9hT8bQZ3rWn2xJv5sM0aE1dL6kC9yRj7fG4uH2tN8pB5cS0xA1zM3wQ6rV9dJ2}
  expMinutes: 43200